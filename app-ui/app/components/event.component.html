<div class="container">
  <div class="content">
    <div class="page-header">
      <h1></h1>
    </div>
    <div class="row">
      <app-left-menu></app-left-menu>
      <div class="col-md-10">
        <div class="container">
          <tabset *ngIf="event">
            <tab i18n-title title=Gifts>
              <div>
                <a class="btn btn-primary" [routerLink]="['addGift']" i18n>Add a gift's idea</a>
              </div>
              <table id="gifts-table" class="table table-striped table-hover table-bordered tablesorter">
                <thead>
                  <tr>
                    <th i18n>Description</th>
                    <th *ngIf="event.eventType == 'Christmas'" class="filter-select filter-exact" data-placeholder="name" i18n>For</th>
                    <th class="filter-select filter-exact" data-placeholder="status" i18n>Status</th>
                    <th i18n>Links</th>
                    <th i18n>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let g of gifts">
                    <td class="col-md-4">{{g.name}}</td>
                    <td class="col-md-1">
                      <span *ngIf="g.to">{{g.to.userName}}</span>
                    </td>
                    <td class="col-md-1">
                      <ng-container *ngIf="g.to && g.to.id !== user.id">
                        <ng-container *ngIf="g.from">
                          <ng-container *ngIf="g.status === 'Bought'">
                            <p class="bg-primary button-tooltip" data-toggle="tooltip" i18n-title title="Offered by {{g.from.userName}}" i18n>Bought</p>
                          </ng-container>
                          <ng-container *ngIf="g.status === 'AboutToBeBought'">
                            <p class="bg-primary button-tooltip" data-toggle="tooltip" i18n-title title="Offered by {{g.from.userName}}" i18n>About to be bought</p>
                          </ng-container>
                        </ng-container>
                        <ng-container *ngIf="!g.from" i18n>
                          <ng-container *ngIf="g.status === 'New'" i18n>New</ng-container>
                          <ng-container *ngIf="g.status === 'AboutToBeBought'" i18n>About to be bought</ng-container>
                          <ng-container *ngIf="g.status === 'Bought'" i18n>Bought</ng-container>
                        </ng-container>
                      </ng-container>
                    </td>
                    <td class="col-md-1">
                      <li *ngFor="let url of g.urls"><a href="{{url}}" target="_blank\" i18n>Link</a></li>
                    </td>
                    <td class="col-md-5">
                      <div class="text-centered">
                        <div class="btn-group">
                          <a class="btn btn-default btn-sm" [routerLink]="['/events', event.id, 'gifts', g.id, 'view']"><i class="glyphicon glyphicon-eye-open button-tooltip" data-toggle="tooltip" i18n-title title="Details"></i></a>
                          <a class="btn btn-default btn-sm" [routerLink]="['/events', event.id, 'gifts', g.id, 'edit']"><i class="glyphicon glyphicon-edit button-tooltip" data-toggle="tooltip" i18n-title title="Modify"></i></a>
                          <button class="btn btn-default btn-sm open-gift-status-modal" data-id="{{g.id}}" [disabled]="!canBuyGift(g)">
                            <i class="glyphicon glyphicon-credit-card button-tooltip" data-toggle="tooltip" (click)="canBuyGift(g) && openBuyGiftModal(g)" i18n-title title="Buy"></i>
                          </button>
                          <button class="btn btn-default btn-sm open-delete-modal" [disabled]="g.creator !== user" data-id="{{g.id}}" data-action="deleteGift"><i class="glyphicon glyphicon-remove"></i></button>
                          <a 
                          [ngClass]="{'btn btn-info btn-sm open-gift-comment-modal': true, 'btn-info': hasComments[g.id], 'btn-default': !hasComments[g.id]}"
                          class="" data-id="{{g.id}}">
                            <i class="glyphicon glyphicon-comment button-tooltip" data-toggle="tooltip" i18ntitle="Comment"></i>
                          </a>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </tab>
            <tab i18n-title title=Participants>
              <table id="participants-table" class="table table-striped table-hover table-bordered tablesorter">
                <thead>
                  <tr>
                    <th i18n>Name</th>
                    <th i18n>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let p of participants">
                    <td>{{p.user.userName}}</td>
                    <td>
                      <select *ngIf="event.creator.id != p.user.id && p.user.id != user.id && p.role === 'Owner';else other_content" name="role">
                        <option value="Owner" [selected]="p.role === 'Owner'" i18n>Owner</option>
                        <option value="Gifter" [selected]="p.role === 'Gifter'" i18n>Gifts buyer</option>
                        <option value="Reader" [selected]="p.role === 'Reader'" i18n>Read only</option>
                      </select>
                      <ng-template #other_content>
                        <ng-container *ngIf="p.role === 'Owner'" i18n>Owner</ng-container>
                        <ng-container *ngIf="p.role === 'Gifter'" i18n>Gifts buyer</ng-container>
                        <ng-container *ngIf="p.role === 'Reader'" i18n>Read only</ng-container>
                      </ng-template>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div id="add-participant-form">
                <form class="form-search form-inline" *ngIf="addParticipantForm" class="col-lg-12" [formGroup]="addParticipantForm" (ngSubmit)="addParticipant(addParticipantForm.value)">
                    <div class="form-group"
                    [ngClass]="{'has-error':fh.hasError(addParticipantForm, 'email')}"
                    >
                        <label for="email" i18n>Email</label>
                        <div class="alert alert-danger" *ngIf="fh.hasError(addParticipantForm, 'email')" i18n>Field required</div>
                        <input class="form-control"
                                id="email"
                                name="email"
                                [formControl]="addParticipantForm.controls['email']"
                        >
                    </div>
                  
                  <button type="submit" class="btn btn-primary" [disabled]="!addParticipantForm.valid"><span i18n>Add</span></button>
                </form>
              </div>
            </tab>
          </tabset>
      </div>
    </div>
  </div>
</div>

<modal #buyGiftModal>
  <ng-container *ngIf="giftToBuy">
    <modal-header [show-close]="true">
        <h4 class="modal-title" i18n>Offer "{{giftToBuy.name}}"</h4>
    </modal-header>
    <modal-body>
        <label for="to" i18n>Change status:</label>
        <select class="form-control" [(ngModel)]="giftToBuyNewStatus" required>
            <option value="New" i18n>New</option>
            <option value="AboutToBeBought" i18n>About to be bought</option>
            <option value="Bought" i18n>Bought</option>
        </select>
    </modal-body>
    <modal-footer>
      <button type="button" class="btn btn-default" data-dismiss="modal" (click)="buyGiftModal.dismiss()" i18n>Cancel</button>
      <button type="button" class="btn btn-primary" (click)="buyGift()" i18n>Confirm</button>
    </modal-footer>
  </ng-container>
</modal>