@(
  user: models.user.User,
  profiles: Seq[com.mohiva.play.silhouette.impl.providers.CommonSocialProfile],
  socialProviders: com.mohiva.play.silhouette.impl.providers.SocialProviderRegistry
)(
  implicit
  flash: Flash, messages: Messages)

@import helper._

@main(title = "Mon profil", connected = Some(user), screen = "profile") {
  @if(flash.get("success")){
      <p class="success">@flash.get("success")</p>
  }

  <div class="container">
    <div class="content">
      <div class="page-header">
              <h1>Mon profil</h1>
      </div>
      <div class="row">
        <div class="span14">
		  <div class="profile">
		    @if(user.isGuest) {
		      <p>
		        You're connected as a guest. Why not
		        <a href="@controllers.routes.RegistrationController.registrationForm()">register</a> or
		        <a href="@controllers.routes.AuthenticationController.signInForm()">sign in</a>
		        ?
		      </p>
		    } else {
		      @user.fullName.map { un =>
		        <div class="fullName">@un</div>
		      }.getOrElse {
		        <div class="fullName">Guest</div>
		      }
		      <div class="logout">
		        <a class="sign-out-link" href="@controllers.routes.AuthenticationController.signOut">Sign Out</a>
		      </div>
		      @defining(profiles.find(_.loginInfo.providerID == "credentials")) { credentials =>
		        <div class="profile-detail">
		          @if(credentials.isDefined) {
		            <em>@credentials.get.email</em>
		          } else {
		            <a href="@controllers.routes.RegistrationController.registrationForm()">Create Account</a>
		          }
		        </div>
		      }
		      @socialProviders.providers.map { provider =>
		        @defining(profiles.find(_.loginInfo.providerID == provider.id)) { profile =>
		          <div class="profile-detail">
		            @if(profile.isDefined) {
		              <div class="provider @provider.id">
		                <img src="@routes.Assets.at("images/providers/" + provider.id + ".png")">
		              </div>
		              <div class="profile-links">
		                <strong>@profile.get.fullName</strong><br/>
		                @profile.get.email<br/>
		              </div>
		            } else {
		              @defining(controllers.routes.AuthenticationController.authenticateSocial(provider.id)) { url =>
		                <a href="@url" class="provider @provider.id">
		                  <img src="@routes.Assets.at("images/providers/" + provider.id + ".png")">
		                </a>
		                <div class="profile-links">
		                  <a href="@url">Connect your @Messages(provider.id) account</a>
		                </div>
		              }
		            }
		            <div class="clear"></div>
		          </div>
		        }
		      }
		    }
		  </div>
        </div>
      </div>
    </div>
  </div>
}
